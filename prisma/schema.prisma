// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =========================
// ENUM
// =========================

enum StatusKaryawan {
  AKTIF
  NONAKTIF
}

enum TipeCutiTahunan {
  PROBATION
  PRORATE
  FULL
}

enum JenisCuti {
  TAHUNAN
  SAKIT
  IZIN
  BAKU
  TANPA_KETERANGAN
  LAINNYA
}

enum KategoriItem {
  ATK
  OBAT
}

// =========================
// MODEL KARYAWAN (MASTER)
// =========================

model Karyawan {
  id            String         @id @default(uuid())
  nik           String         @unique
  nama          String
  jabatan       String?
  departemen    String?
  tanggalMasuk  DateTime
  status        StatusKaryawan @default(AKTIF)

  cutiTahunan   CutiTahunan[]
  cuti          Cuti[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

// =========================
// MODEL CUTI TAHUNAN
// 1 karyawan = 1 record per tahun
// =========================

model CutiTahunan {
  id             String          @id @default(uuid())
  karyawanId     String
  tahun          Int

  jatahDasar     Int             // 0 / 7 / 12
  carryForward   Int             @default(0)
  totalHakCuti   Int             // jatahDasar + carryForward
  cutiTerpakai   Int             @default(0)
  sisaCuti       Int

  tipe           TipeCutiTahunan // PROBATION / PRORATE / FULL

  karyawan       Karyawan        @relation(fields: [karyawanId], references: [id])
  cuti           Cuti[]

  createdAt      DateTime        @default(now())

  @@unique([karyawanId, tahun])
}

// =========================
// MODEL TRANSAKSI CUTI
// (Pencatatan langsung, tanpa approval)
// =========================

model Cuti {
  id             String        @id @default(uuid())
  karyawanId     String
  cutiTahunanId  String

  tahun          Int
  jenis          JenisCuti
  alasan         String

  tanggalMulai   DateTime
  tanggalSelesai DateTime
  jumlahHari     Int

  karyawan       Karyawan      @relation(fields: [karyawanId], references: [id])
  cutiTahunan    CutiTahunan   @relation(fields: [cutiTahunanId], references: [id])

  createdAt      DateTime      @default(now())
}

// =========================
// MODEL INVENTORY
// =========================

model Item {
  id              String          @id @default(uuid())
  kode            String          @unique
  nama            String
  kategori        KategoriItem
  satuan          String          // pcs, box, rim, botol, tablet, strip, dll
  stokMinimal     Int             @default(0)
  stokSekarang    Int             @default(0)
  keterangan      String?

  pembelian       Pembelian[]
  pengeluaran     Pengeluaran[]

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([kategori])
  @@index([kode])
}

// =========================
// MODEL PEMBELIAN (STOCK MASUK)
// =========================

model Pembelian {
  id              String          @id @default(uuid())
  itemId          String
  jumlah          Int
  tanggal         DateTime
  supplier        String?         // nama supplier/toko
  hargaSatuan     Int             // harga per satuan dalam rupiah
  totalHarga      Int             // jumlah * hargaSatuan
  keterangan      String?         // catatan tambahan

  item            Item            @relation(fields: [itemId], references: [id])

  createdAt       DateTime        @default(now())

  @@index([itemId])
  @@index([tanggal])
}

// =========================
// MODEL PENGELUARAN (STOCK KELUAR)
// =========================

model Pengeluaran {
  id              String          @id @default(uuid())
  itemId          String
  jumlah          Int
  tanggal         DateTime
  keperluan       String          // untuk siapa/apa
  penerima        String?         // nama penerima
  keterangan      String?         // catatan tambahan

  item            Item            @relation(fields: [itemId], references: [id])

  createdAt       DateTime        @default(now())

  @@index([itemId])
  @@index([tanggal])
}
